# User Review Endpoints
createReview:
  handler: src/reviews/lambda/user/createReview.handler
  events:
    - http:
        path: /v1/reviews
        method: POST
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
updateReview:
  handler: src/reviews/lambda/user/updateReview.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}
        method: PUT
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
deleteReview:
  handler: src/reviews/lambda/user/deleteReview.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}
        method: DELETE
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
voteHelpful:
  handler: src/reviews/lambda/user/voteHelpful.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}/helpful
        method: POST
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
removeHelpfulVote:
  handler: src/reviews/lambda/user/removeHelpfulVote.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}/helpful
        method: DELETE
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getMyReviews:
  handler: src/reviews/lambda/user/getMyReviews.handler
  events:
    - http:
        path: /v1/reviews/my
        method: GET
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getReviewImageUploadUrl:
  handler: src/reviews/lambda/user/getReviewImageUploadUrl.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}/images/upload-url
        method: POST
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
    ASSETS_BUCKET_NAME: ${self:custom.resourceNames.assetsBucket}

# Host Review Endpoints
respondToReview:
  handler: src/reviews/lambda/host/respondToReview.handler
  events:
    - http:
        path: /v1/reviews/{reviewId}/host/response
        method: POST
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getHostReviews:
  handler: src/reviews/lambda/host/getHostReviews.handler
  events:
    - http:
        path: /v1/reviews/host
        method: GET
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
# Public Review Endpoints
getExperienceReviews:
  handler: src/reviews/lambda/public/getExperienceReviews.handler
  events:
    - http:
        path: /v1/experiences/{experienceId}/reviews
        method: GET
        cors: true
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getReviewStats:
  handler: src/reviews/lambda/public/getReviewStats.handler
  events:
    - http:
        path: /v1/experiences/{experienceId}/review-stats
        method: GET
        cors: true
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getPublicHostReviews:
  handler: src/reviews/lambda/public/getHostReviews.handler
  events:
    - http:
        path: /v1/hosts/{hostId}/reviews
        method: GET
        cors: true
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
# Admin Review Endpoints
moderateReview:
  handler: src/reviews/lambda/admin/moderateReview.handler
  events:
    - http:
        path: /v1/admin/reviews/{reviewId}/moderate
        method: PUT
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port
getAllReviews:
  handler: src/reviews/lambda/admin/getAllReviews.handler
  events:
    - http:
        path: /v1/admin/reviews
        method: GET
        cors: true
        authorizer:
          type: COGNITO_USER_POOLS
          authorizerId: { Ref: ApiGatewayAuthorizer }
  vpc:
    securityGroupIds:
      - !Ref ProxySecurityGroup
    subnetIds:
      - !Ref PrivateSubnetA
      - !Ref PrivateSubnetB
  environment:
    POSTGRES_DB: ${self:custom.resourceNames.postgresDB}
    POSTGRES_USERNAME: ${env:POSTGRES_USERNAME}
    POSTGRES_PASSWORD: ${env:POSTGRES_PASSWORD}
    USE_RDS_PROXY: ${self:custom.useRdsProxy.${self:provider.stage}}
    RDS_CLUSTER_ENDPOINT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Address
    RDS_CLUSTER_PORT: !GetAtt PostgresRDSServerlessCluster.Endpoint.Port